name: 'Build APK/Bundle in release mode'
description: >
  The purpose of this action is a safe environment for executing your gradle tasks.
  The tasks:
    1) Cleans the environment using `./gradlew clean` before the compilation.
    2) Builds an APK in release mode.
    3) Upload the symbols file to Crashlytics.

inputs:
  technical-version:
    required: true
    description: The technical version of the build.

  app:
    required: true
    description: 'Application name, for example: facetune, pixaloop, etc...'

  flavor:
    required: false
    default: ''
    description: "Optional. Android release flavor (like `Gms` for example)"

runs:
  using: "composite"
  steps:
    - name: "Set TECHNICAL VERSION"
      shell: bash
      run: echo TECHNICAL_VERSION=${{inputs.technical-version}} >> $GITHUB_ENV

    - name: "Clean environment"
      shell: bash
      run: ./gradlew clean

    - name: "Build APK in release"
      shell: bash
      run: ./gradlew :${{inputs.app}}:assemble${{inputs.flavor}}Release

    - name: "Upload symbols to Crashlytics"
      shell: bash
      run: ./gradlew :${{inputs.app}}:uploadCrashlyticsSymbolFile${{inputs.flavor}}Release
